<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>üèãÔ∏è‚Äç‚ôÇÔ∏è Gym Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;

      --bg-gradient: linear-gradient(135deg, #0f172a, #1e293b);
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --accent-soft-2: #eff6ff;
      --card-bg: #ffffff;
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
    }

    body {
      margin: 0;
      padding: 1rem;
      background: var(--bg-gradient);
      color: var(--text-main);
    }

    .app {
      max-width: 760px;
      margin: 0 auto 2rem;
    }

    /* Header ‚Äúhero‚Äù */
    header {
      margin: 0 0 1rem;
      padding: 1rem 1.1rem 1.2rem;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #38bdf8 0, #0f172a 48%, #020617 100%);
      color: #e5f2ff;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.45);
      position: relative;
      overflow: hidden;
    }

    header::after {
      content: "";
      position: absolute;
      right: -40px;
      top: -40px;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, rgba(59,130,246,0.5), transparent 60%);
      opacity: 0.7;
    }

    header h1 {
      font-size: 1.6rem;
      margin: 0 0 0.2rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    header h1 span.icon {
      font-size: 1.5rem;
    }

    header p {
      margin: 0;
      font-size: 0.9rem;
      color: #cbd5f5;
    }

    header .subtitle {
      margin-top: 0.4rem;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #93c5fd;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 0.9rem 1rem;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.35);
      margin-bottom: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    label {
      font-size: 0.8rem;
      font-weight: 500;
      display: block;
      margin-bottom: 0.15rem;
      color: #374151;
    }

    input,
    select {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 10px;
      border: 1px solid #bfdbfe;      /* azzurrino */
      box-sizing: border-box;
      font-size: 0.9rem;
      background: #eff6ff;            /* sfondo chiaro azzurrino */
      color: #0f172a;                 /* testo scuro ben leggibile */
    }

    input::placeholder,
    select::placeholder {
      color: #9ca3af;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
      background: #ffffff;
      color: #0f172a;
    }

    /* Fix specifico per input data su Safari/iOS */
    #dateInput {
      width: 100%;
      max-width: 100%;
      min-width: 0;
      -webkit-appearance: none;
    }

    .config-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
      gap: 0.75rem;
      align-items: end;
    }

    .config-grid > div {
      min-width: 0;
      overflow: hidden;  /* impedisce al contenuto di far ‚Äúuscire‚Äù la colonna */
    }

    .config-hint {
      margin-top: 0.4rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.4rem;
    }

    .section-title h2 {
      font-size: 1.05rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      color: #0f172a;
    }

    .section-title span.badge {
      font-size: 0.75rem;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .exercise-card {
      margin-bottom: 0.75rem;
      padding: 0.75rem 0.85rem;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }

    .exercise-card::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(to bottom, #38bdf8, #4ade80);
      opacity: 0.9;
    }

    .exercise-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.3rem;
    }

    .exercise-card h3 {
      margin: 0 0 0.1rem;
      font-size: 0.98rem;
      font-weight: 600;
      color: #111827;
    }

    .exercise-tempo {
      font-size: 0.74rem;
      color: #6b7280;
      margin-top: 0.1rem;
    }

    .set-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.3rem 0.75rem;
      margin-top: 0.45rem;
      padding-top: 0.35rem;
      border-top: 1px dashed #e5e7eb;
    }

    .set-title {
      font-size: 0.78rem;
      font-weight: 600;
      color: #4b5563;
      grid-column: 1 / -1;
    }

    .note-field {
      grid-column: 1 / -1;
    }

    .note-field input {
      font-size: 0.85rem;
    }

    .note-field input::placeholder {
      font-size: 0.8rem;
    }

    .buttons-row {
      display: flex;
      gap: 0.6rem;
      margin: 0.7rem 0 1rem;
    }

    .buttons-row button {
      flex: 1;
      padding: 0.65rem 0.9rem;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      letter-spacing: 0.01em;
    }

    .primary-btn {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: #ffffff;
    }

    .secondary-btn {
      background: #e5e7eb;
      color: #111827;
    }

    .primary-btn:active,
    .secondary-btn:active {
      transform: scale(0.97);
    }

    h2 {
      font-size: 1.05rem;
      margin: 0 0 0.4rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      border-radius: 12px;
      overflow: hidden;
    }

    th,
    td {
      border-bottom: 1px solid #e5e7eb;
      padding: 0.3rem 0.35rem;
      text-align: left;
      vertical-align: top;
    }

    th {
      font-weight: 600;
      color: #4b5563;
      background: #eff6ff;
    }

    tbody tr:nth-child(odd) {
      background: #f9fafb;
    }

    tbody tr:nth-child(even) {
      background: #ffffff;
    }

    #historyEmpty {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    @media (max-width: 600px) {
      body {
        padding: 0.7rem;
      }

      header {
        padding: 0.9rem 0.9rem 1rem;
      }

      .card {
        padding: 0.85rem 0.85rem;
      }

      .config-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      .buttons-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1><span class="icon">üèãÔ∏è‚Äç‚ôÇÔ∏è</span>Gym Tracker</h1>
      <p>Traccia peso, ripetizioni e note per i tuoi 3 allenamenti Full Body.</p>
      <div class="subtitle">FULLBODY DURO ¬∑ 8 SETTIMANE</div>
    </header>

    <!-- Configurazione giorno + allenamento -->
    <section class="card">
      <div class="section-title">
        <h2>Sessione di oggi</h2>
        <span class="badge">Step 1 ¬∑ Setup</span>
      </div>
      <div class="config-grid">
        <div>
          <label for="dateInput">Data</label>
          <input type="date" id="dateInput" />
        </div>
        <div>
          <label for="workoutSelect">Allenamento</label>
          <select id="workoutSelect"></select>
        </div>
      </div>
      <div class="config-hint">Scegli l‚Äôallenamento e compila almeno una serie prima di salvare.</div>
    </section>

    <!-- Esercizi dinamici -->
    <section class="card">
      <div class="section-title">
        <h2>Lista esercizi</h2>
        <span class="badge">Step 2 ¬∑ Compila</span>
      </div>
      <div id="exercisesContainer"></div>
    </section>

    <!-- Bottoni azione -->
    <div class="buttons-row">
      <button id="saveWorkoutBtn" class="primary-btn">
        üíæ <span>Salva allenamento</span>
      </button>
      <button id="exportCsvBtn" class="secondary-btn">
        üì§ <span>Esporta CSV</span>
      </button>
    </div>

    <!-- Storico -->
    <section class="card">
      <div class="section-title">
        <h2>Storico allenamenti</h2>
        <span class="badge">Step 3 ¬∑ Review</span>
      </div>
      <div id="history"></div>
    </section>
  </div>

  <script>
    // === DATI ALLENAMENTI ===
    const WORKOUTS = [
      {
        id: 'A1',
        name: 'Allenamento 1',
        exercises: [
          { id: 'a1_curl_gomiti', name: 'Curl con gomiti appoggiati', tempo: '3111' },
          { id: 'a1_alzate_y', name: 'Alzate ad Y manubri su panca', tempo: '2112' },
          { id: 'a1_pullover', name: 'Pullover petto e tricipiti', tempo: '3111' },
          { id: 'a1_pressa_quad', name: 'Pressa focus quadricipiti', tempo: '3211' },
          { id: 'a1_leg_curl', name: 'Leg curl sdraiato', tempo: '3112' },
          { id: 'a1_pulley_upper', name: 'Pulley per upper back gomiti stretti', tempo: '3112' },
          { id: 'a1_polpacci', name: 'Polpacci alla pressa a una gamba', tempo: '3511' },
          { id: 'a1_crunch_panca', name: 'Crunch su panca', tempo: '3112' }
        ]
      },
      {
        id: 'A2',
        name: 'Allenamento 2',
        exercises: [
          { id: 'a2_spinte_70', name: 'Spinte panca 70¬∞ al multipower (spalle)', tempo: '3211' },
          { id: 'a2_estensioni_tric', name: 'Estensioni su panca inclinata per tricipiti', tempo: '3111' },
          { id: 'a2_curl_cavo', name: 'Curl al cavo tra le gambe', tempo: '2211' },
          { id: 'a2_polpacci_pressa', name: 'Polpacci alla pressa', tempo: '3511' },
          { id: 'a2_pec_deck', name: 'Pec Deck / Pec Fly', tempo: '3111' },
          { id: 'a2_leg_curl_una', name: 'Leg curl sdraiato a una gamba', tempo: '3112' },
          { id: 'a2_crunch_cavo', name: 'Crunch al cavo', tempo: '3112' }
        ]
      },
      {
        id: 'A3',
        name: 'Allenamento 3',
        exercises: [
          { id: 'a3_spinte_1530', name: 'Spinte petto su panca 15‚Äì30¬∞', tempo: '3111' },
          { id: 'a3_pushdown', name: 'Pushdown a braccio singolo', tempo: '3111' },
          { id: 'a3_curl_martello', name: 'Curl a martello con gomiti appoggiati', tempo: '3111' },
          { id: 'a3_alzate_laterali_cavo', name: 'Alzate laterali braccio singolo al cavo basso', tempo: '3111' },
          { id: 'a3_leg_extension', name: 'Leg extension (unilaterale)', tempo: '3112' },
          { id: 'a3_iperestensioni', name: 'Iperestensioni 45¬∞ femorali', tempo: '3111' },
          { id: 'a3_pulley_upper', name: 'Pulley per upper back', tempo: '3112' },
          { id: 'a3_stiff_arm', name: 'Stiff arm pulldown su panca', tempo: '3112' }
        ]
      }
    ];

    const STORAGE_KEY = 'gymEntries_v2';
    let entries = [];

    function loadData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) {
        entries = [];
        return;
      }
      try {
        entries = JSON.parse(saved) || [];
      } catch (e) {
        entries = [];
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
    }

    function populateWorkoutSelect() {
      const select = document.getElementById('workoutSelect');
      WORKOUTS.forEach((w) => {
        const opt = document.createElement('option');
        opt.value = w.id;
        opt.textContent = w.name;
        select.appendChild(opt);
      });
    }

    function getWorkoutById(id) {
      return WORKOUTS.find((w) => w.id === id) || WORKOUTS[0];
    }

    function renderExercises() {
      const container = document.getElementById('exercisesContainer');
      const workoutId = document.getElementById('workoutSelect').value;
      const workout = getWorkoutById(workoutId);

      container.innerHTML = '';

      workout.exercises.forEach((ex) => {
        const card = document.createElement('div');
        card.className = 'exercise-card';
        card.dataset.exerciseId = ex.id;
        card.dataset.exerciseName = ex.name;

        const header = document.createElement('div');
        header.className = 'exercise-header';

        const title = document.createElement('h3');
        title.textContent = ex.name;

        const tempo = document.createElement('div');
        tempo.className = 'exercise-tempo';
        tempo.textContent = 'Tempo: ' + ex.tempo;

        header.appendChild(title);
        header.appendChild(tempo);
        card.appendChild(header);

        // 2 serie per ogni esercizio
        for (let setIndex = 1; setIndex <= 2; setIndex++) {
          const row = document.createElement('div');
          row.className = 'set-row';
          row.dataset.setIndex = String(setIndex);

          const setLabel = document.createElement('div');
          setLabel.className = 'set-title';
          setLabel.textContent = 'Serie ' + setIndex;
          row.appendChild(setLabel);

          // Peso
          const pesoWrap = document.createElement('div');
          const pesoLabel = document.createElement('label');
          pesoLabel.textContent = 'Peso (kg)';
          const pesoInput = document.createElement('input');
          pesoInput.type = 'number';
          pesoInput.step = '0.5';
          pesoInput.inputMode = 'decimal';
          pesoInput.className = 'peso-input';
          pesoWrap.appendChild(pesoLabel);
          pesoWrap.appendChild(pesoInput);

          // Ripetizioni
          const repsWrap = document.createElement('div');
          const repsLabel = document.createElement('label');
          repsLabel.textContent = 'Ripetizioni';
          const repsInput = document.createElement('input');
          repsInput.type = 'number';
          repsInput.inputMode = 'numeric';
          repsInput.className = 'reps-input';
          repsWrap.appendChild(repsLabel);
          repsWrap.appendChild(repsInput);

          row.appendChild(pesoWrap);
          row.appendChild(repsWrap);

          // Note
          const noteWrap = document.createElement('div');
          noteWrap.className = 'note-field';
          const noteLabel = document.createElement('label');
          noteLabel.textContent = 'Note';
          const noteInput = document.createElement('input');
          noteInput.type = 'text';
          noteInput.className = 'note-input';
          noteInput.placeholder = 'Sensazioni, RPE, buffer...';
          noteWrap.appendChild(noteLabel);
          noteWrap.appendChild(noteInput);

          row.appendChild(noteWrap);
          card.appendChild(row);
        }

        container.appendChild(card);
      });
    }

    function renderHistory() {
      const container = document.getElementById('history');
      if (!entries.length) {
        container.innerHTML = '<div id="historyEmpty">Nessun allenamento salvato finora.</div>';
        return;
      }

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      thead.innerHTML =
        '<tr><th>Data</th><th>Allenamento</th><th>Esercizio</th><th>Serie</th><th>Peso</th><th>Rep</th><th>Note</th></tr>';
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      // Mostra prima le serie pi√π recenti
      entries
        .slice()
        .reverse()
        .forEach((e) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${e.date}</td>
            <td>${e.workoutName}</td>
            <td>${e.exerciseName}</td>
            <td>${e.set}</td>
            <td>${e.weight ?? ''}</td>
            <td>${e.reps ?? ''}</td>
            <td>${e.notes ? e.notes : ''}</td>
          `;
          tbody.appendChild(tr);
        });

      table.appendChild(tbody);
      container.innerHTML = '';
      container.appendChild(table);
    }

    function clearFormInputs() {
      document
        .querySelectorAll('.exercise-card .peso-input, .exercise-card .reps-input, .exercise-card .note-input')
        .forEach((inp) => (inp.value = ''));
    }

    function saveWorkout() {
      const dateInput = document.getElementById('dateInput');
      let dateStr = dateInput.value;

      if (!dateStr) {
        const today = new Date();
        const y = today.getFullYear();
        const m = String(today.getMonth() + 1).padStart(2, '0');
        const d = String(today.getDate()).padStart(2, '0');
        dateStr = `${y}-${m}-${d}`;
        dateInput.value = dateStr;
      }

      const workoutSel = document.getElementById('workoutSelect');
      const workoutId = workoutSel.value;
      const workout = getWorkoutById(workoutId);

      const cards = document.querySelectorAll('.exercise-card');
      const newEntries = [];

      cards.forEach((card) => {
        const exerciseId = card.dataset.exerciseId;
        const exerciseName = card.dataset.exerciseName;
        const rows = card.querySelectorAll('.set-row');

        rows.forEach((row) => {
          const setIndex = parseInt(row.dataset.setIndex, 10);
          const pesoInput = row.querySelector('.peso-input');
          const repsInput = row.querySelector('.reps-input');
          const noteInput = row.querySelector('.note-input');

          const pesoVal = pesoInput.value.trim();
          const repsVal = repsInput.value.trim();
          const notesVal = noteInput.value.trim();

          // Se √® completamente vuota, salta
          if (!pesoVal && !repsVal && !notesVal) {
            return;
          }

          const weight = pesoVal ? parseFloat(pesoVal.replace(',', '.')) : null;
          const reps = repsVal ? parseInt(repsVal, 10) : null;

          if ((pesoVal && isNaN(weight)) || (repsVal && isNaN(reps))) {
            return; // scarta input non validi
          }

          newEntries.push({
            date: dateStr,
            workoutId,
            workoutName: workout.name,
            exerciseId,
            exerciseName,
            set: setIndex,
            weight,
            reps,
            notes: notesVal
          });
        });
      });

      if (!newEntries.length) {
        alert('Compila almeno una serie prima di salvare.');
        return;
      }

      entries = entries.concat(newEntries);
      saveData();
      clearFormInputs();
      renderHistory();
      alert('Allenamento salvato ‚úÖ');
    }

    function exportCsv() {
      if (!entries.length) {
        alert('Non ci sono dati da esportare.');
        return;
      }

      const header = ['Data', 'Allenamento', 'Esercizio', 'Serie', 'Peso', 'Ripetizioni', 'Note'];
      const rows = entries.map((e) => [
        e.date,
        e.workoutName,
        e.exerciseName,
        e.set,
        e.weight ?? '',
        e.reps ?? '',
        e.notes || ''
      ]);

      const csvLines = [header, ...rows].map((row) =>
        row.map((field) => `"${String(field).replace(/"/g, '""')}"`).join(',')
      );
      const csvContent = csvLines.join('\r\n');

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'gym_tracker_history.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadData();
      populateWorkoutSelect();

      // Data di default = oggi
      const dateInput = document.getElementById('dateInput');
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth() + 1).padStart(2, '0');
      const d = String(today.getDate()).padStart(2, '0');
      dateInput.value = `${y}-${m}-${d}`;

      renderExercises();
      renderHistory();

      document.getElementById('workoutSelect').addEventListener('change', () => {
        renderExercises();
        clearFormInputs();
      });

      document.getElementById('saveWorkoutBtn').addEventListener('click', saveWorkout);
      document.getElementById('exportCsvBtn').addEventListener('click', exportCsv);
    });
  </script>
</body>
</html>
